{% extends "layout.html" %}

{% block body %}
 <form class="search" method="post">
    <h3>Search</h3>
     <hr />
    <div class="col">
        <div class="row">
            {{ form.science.label }}
        </div>
        <div class="row">
            {{ form.science }}
        </div>
        <br />
        <div class="row">
           {{ form.supervisor.label }}
        </div>
        <div class="row">
            {{ form.supervisor }}
        </div>
        <br />
        <div class="row">
            {{ form.departments.label }}
        </div>
        <div class="row">
            {{ form.departments }}
        </div>
        <br />
        <div class="row">
            {{ form.status.label }}
        </div>
        <div class="row">
            {{ form.status }}
        </div>
    </div>
     <hr />
     <br />
     <input class="btn btn-primary" type="submit" value="Search">
</form> 
{# Allow admin or the thesis topic author to edit the thesis #}
    {% if (current_user.is_authenticated) %}
<a class="btn btn-outline-primary" href=" {{ url_for('theses_form') }} " role="button">Create</a><br /><br />
{% endif %}



<table>
    <tr>
        <th>Thesis</th>
        <th>Supervisor</th>
        <th>Email</th>
        <th>Department</th>
        <th>MSc. / BSc.</th>
        {% if (current_user.is_authenticated) %}

        <th>Assigned author</th>
        {% endif %}
        <th>Sciences</th>
        <th>Status</th>
        <th>Created</th>
        <th>Reserved</th>
        <th>Completed</th>
        <th colspan="3"></th>
        
    </tr>
    {# a Show error if there are no theses #}
      {% if theses|length < 1 %}
      <tr>
          <td colspan="11">There are no theses in the system</td>
      </tr>
    {% else %}
    {% for thesis in theses %}
    <tr>
        <td><b>{{ thesis.title }}</b><br />
        <button type="button" class="btn btn-outline-secondary" title="{{ thesis.title }}" data-trigger="focus" data-container="body" data-toggle="popover" data-placement="right" data-content="{{thesis.description}}">
        Description</button></td>
  
        {% set fullname = thesis.account.firstName + ' ' + thesis.account.lastName %}
            <td>{{fullname}}</td>
            <td>{{ thesis.userID }}</td>
        
            <td>{% for dept in depts %} {% if dept.departmentID == thesis.account.department %} {{dept.name}} {% endif %} {% endfor %}</td>
  
            {% if thesis.level %}
            <td>Master</td>
            {% elif thesis.level is not none %} 
            <td>Bachelor</td>
            {% else %}
            <td />
            {% endif %}
        
        {# Allow admin or supervisor to see the author #}

        {% if (current_user.is_authenticated) %}
            <td>{{ thesis.author if thesis.author}}</td>
        {% endif %}
            <td>                
                <ul class="listings">
                {% for id in thesis.sciences %}
                    <li class="listings">{{id.name}}</li>
                    {% endfor %}
                </ul>
                
            </td>
            
            <td>
            {% if thesis.status == 0 %}
                <div class="alert alert-success" role="alert">
                {{ statuses[thesis.status] }}
            </div>
            {% elif thesis.status == 1 %}
                <div class="alert alert-warning" role="alert">
                    {{ statuses[thesis.status] }}
                </div>
            {% elif thesis.status == 2 %}
                <div class="alert alert-primary" role="alert">
                    {{ statuses[thesis.status] }}
                </div>
            {% endif %}
            </td>
            <td>{{ thesis.createdOn }}</td>
            <td>{{ thesis.reservedOn if thesis.reservedOn }}</td>
            <td>{{ thesis.completedOn if thesis.completedOn }}</td>
            
            {# Current user actions are Edit / finalize based on the status #}
            {% if current_user.userID == thesis.userID and not current_user.admin %}
            <td colspan="3">
                {% if thesis.status == 0%}

                <form method="GET" action="{{ url_for('thesis_edit', thesis_id=thesis.thesisID) }}">
                    <input class="btn btn-outline-primary" type="submit" value="Edit">
                </form>

                {% elif thesis.status == 1 %}
                <form method="GET" action="{{ url_for('thesis_finalize', thesis_id=thesis.thesisID) }}">
                    <input class="btn btn-outline-success" type="submit" value="Finalize">
                </form>
                {% endif %}
            </td>

            {# Admin actions are Edit / Delete / Finalize #}
            {# Delete is displayed just for the showcase even if status does not permit deleting #}
            {% elif current_user.admin %}
            <td>
                <form method="GET" action="{{ url_for('thesis_edit', thesis_id=thesis.thesisID) }}">
                    <input class="btn btn-outline-primary btn-sm" type="submit" value="Edit">
                </form>
            </td>
            <td>
                {% if thesis.status != 0 %}
                <a tabindex="0" class="btn btn-outline-danger btn-sm" role="button" data-toggle="popover" data-trigger="focus" data-content="Thesis status does not allow deletion"><s>Delete</s></a>
                {% else %}
                <form method="POST" action="{{ url_for('thesis_delete', thesis_id=thesis.thesisID) }}">
                    <input class="btn btn-outline-danger btn-sm" type="submit" value="Delete">
                </form>
                {% endif %}
            </td>
            <td>
                {% if thesis.status == 1 %}

                <form method="GET" action="{{ url_for('thesis_finalize', thesis_id=thesis.thesisID) }}">
                    <input class="btn btn-outline-success btn-sm" type="submit" value="Finalize">
                </form>

                {% endif %}
            </td>
            {% else %}
        <td colspan="3"></td>
        {% endif %}








</tr>
    {% endfor %}
      {% endif %}
</table>
{% endblock %}
